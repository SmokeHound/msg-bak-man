<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package
    Name="$(var.ProductName)"
    Manufacturer="$(var.Manufacturer)"
    Version="$(var.ProductVersion)"
    UpgradeCode="2D9B1F3C-83C0-4C3F-8FE2-7E71B1E8F6A5"
    Scope="perMachine"
    Compressed="yes"
    Language="1033">

    <SummaryInformation Description="$(var.ProductName)" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of $(var.ProductName) is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <Icon Id="AppIcon" SourceFile="..\..\src\MsgBakMan.App\Assets\msgbakman.ico" />
    <Property Id="ARPPRODUCTICON" Value="AppIcon" />
    <Property Id="ARPCONTACT" Value="$(var.Manufacturer)" />
    <Property Id="ARPCOMMENTS" Value="Import, merge, and export SMS Backup &amp; Restore XML backups." />

    <!-- Optional feature toggles (can be overridden via MSI properties) -->
    <Property Id="INSTALLDESKTOPSHORTCUT" Value="1" />

    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="$(var.ProductName)" />
    </StandardDirectory>

    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="AppProgramMenuFolder" Name="$(var.ProductName)" />
    </StandardDirectory>

    <StandardDirectory Id="DesktopFolder" />

    <Component Id="MainExe" Directory="INSTALLFOLDER" Guid="{3E294D1B-95EC-45E0-ABF8-93AD9E0E1194}">
      <File Id="MsgBakManExe" Source="!(bindpath.App)\MsgBakMan.App.exe" KeyPath="yes" />
    </Component>

    <Component Id="StartMenuShortcuts" Directory="INSTALLFOLDER" Guid="{074666DE-FB0C-4FF3-9A1C-DAC6ECFF9056}">
      <Shortcut
        Id="StartMenuShortcut"
        Directory="AppProgramMenuFolder"
        Name="$(var.ProductName)"
        Target="[INSTALLFOLDER]MsgBakMan.App.exe"
        WorkingDirectory="INSTALLFOLDER"
        Icon="AppIcon" />

      <RemoveFolder Id="RemoveAppProgramMenuFolder" Directory="AppProgramMenuFolder" On="uninstall" />
      <RegistryValue Root="HKCU" Key="Software\$(var.Manufacturer)\$(var.ProductName)" Name="InstallDir" Type="string" Value="[INSTALLFOLDER]" KeyPath="yes" />
    </Component>

    <Component Id="DesktopShortcut" Directory="INSTALLFOLDER" Guid="{F3B0AE0B-EB0E-4DBA-BD45-BCCA2225CB88}" Condition="INSTALLDESKTOPSHORTCUT=1">
      <Shortcut
        Id="DesktopShortcut"
        Directory="DesktopFolder"
        Name="$(var.ProductName)"
        Target="[INSTALLFOLDER]MsgBakMan.App.exe"
        WorkingDirectory="INSTALLFOLDER"
        Icon="AppIcon" />

      <RegistryValue Root="HKCU" Key="Software\$(var.Manufacturer)\$(var.ProductName)\Shortcuts" Name="Desktop" Type="integer" Value="1" KeyPath="yes" />
    </Component>

    <Feature Id="MainFeature" Title="$(var.ProductName)" Level="1">
      <!-- Harvest all app output files into this feature. -->
      <Files Directory="INSTALLFOLDER" Include="!(bindpath.App)\**">
        <Exclude Files="!(bindpath.App)\MsgBakMan.App.exe" />
        <Exclude Files="!(bindpath.App)\**\*.pdb" />
      </Files>

      <ComponentRef Id="MainExe" />
      <ComponentRef Id="StartMenuShortcuts" />
      <ComponentRef Id="DesktopShortcut" />
    </Feature>

    <WixVariable Id="WixUILicenseRtf" Value="License-en.rtf" />
    <ui:WixUI Id="WixUI_InstallDir" InstallDirectory="INSTALLFOLDER" />
  </Package>
</Wix>
