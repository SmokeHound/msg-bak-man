<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Fragment>
    <!-- UI resources -->
    <Binary Id="CustomUI_BannerBmp" SourceFile="BannerTop.bmp" />

    <!-- UI properties -->
    <Property Id="LicenseAccepted" Value="0" />
    <Property Id="LAUNCHAPP" Value="1" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <Property Id="ErrorDialog" Value="ErrorDlg" />

    <UI Id="CustomUI_MsgBakMan">
      <TextStyle Id="WixUI_Font_Normal" FaceName="Segoe UI" Size="9" />
      <TextStyle Id="WixUI_Font_Bigger" FaceName="Segoe UI" Size="12" />
      <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />

      <!-- Show our first dialog in a fresh install -->
      <InstallUISequence>
        <Show Dialog="MbmWelcomeDlg" Before="CostInitialize" Condition="NOT Installed" />
        <Show Dialog="MbmExitDlg" OnExit="success" />
        <Show Dialog="UserExit" OnExit="cancel" />
        <Show Dialog="FatalError" OnExit="error" />
      </InstallUISequence>

      <AdminUISequence>
        <Show Dialog="Exit" OnExit="success" />
        <Show Dialog="UserExit" OnExit="cancel" />
        <Show Dialog="FatalError" OnExit="error" />
      </AdminUISequence>

      <!-- Welcome -->
      <Dialog Id="MbmWelcomeDlg" Width="370" Height="270" Title="[ProductName]" NoMinimize="yes">
        <Control Id="Banner" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="yes" Text="CustomUI_BannerBmp" />
        <Control Id="Line" Type="Line" X="0" Y="44" Width="370" Height="0" />

        <Control Id="Title" Type="Text" X="15" Y="58" Width="340" Height="24" Transparent="yes" NoPrefix="yes" Text="Welcome to the [ProductName] Setup Wizard" />
        <Control Id="Description" Type="Text" X="15" Y="86" Width="340" Height="40" Transparent="yes" Text="This wizard will guide you through the installation." />

        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="Next">
          <Publish Event="NewDialog" Value="MbmLicenseDlg" Condition="1" />
        </Control>
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="Cancel">
          <Publish Event="SpawnDialog" Value="MbmCancelDlg" Condition="1" />
        </Control>
      </Dialog>

      <!-- License -->
      <Dialog Id="MbmLicenseDlg" Width="370" Height="270" Title="[ProductName]" NoMinimize="yes">
        <Control Id="Banner" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="yes" Text="CustomUI_BannerBmp" />
        <Control Id="Line" Type="Line" X="0" Y="44" Width="370" Height="0" />

        <Control Id="Title" Type="Text" X="15" Y="58" Width="340" Height="18" Transparent="yes" NoPrefix="yes" Text="End-User License Agreement" />

        <Control Id="LicenseText" Type="ScrollableText" X="15" Y="78" Width="340" Height="120" Sunken="yes" TabSkip="no">
          <Text SourceFile="License-en.rtf" />
        </Control>

        <Control Id="Accept" Type="CheckBox" X="15" Y="205" Width="340" Height="16" Property="LicenseAccepted" CheckBoxValue="1" Text="I accept the terms in the License Agreement">
          <Publish Event="Enable" Value="Next" Condition="LicenseAccepted = 1" />
          <Publish Event="Disable" Value="Next" Condition="LicenseAccepted &lt;&gt; 1" />
        </Control>

        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="Back">
          <Publish Event="NewDialog" Value="MbmWelcomeDlg" Condition="1" />
        </Control>
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="Next" Disabled="yes">
          <Publish Event="NewDialog" Value="MbmInstallDirDlg" Condition="LicenseAccepted = 1" />
        </Control>
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="Cancel">
          <Publish Event="SpawnDialog" Value="MbmCancelDlg" Condition="1" />
        </Control>

      </Dialog>

      <!-- Install location -->
      <Dialog Id="MbmInstallDirDlg" Width="370" Height="270" Title="[ProductName]" NoMinimize="yes" TrackDiskSpace="yes">
        <Control Id="Banner" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="yes" Text="CustomUI_BannerBmp" />
        <Control Id="Line" Type="Line" X="0" Y="44" Width="370" Height="0" />

        <Control Id="Title" Type="Text" X="15" Y="58" Width="340" Height="18" Transparent="yes" NoPrefix="yes" Text="Choose Install Location" />
        <Control Id="Description" Type="Text" X="15" Y="78" Width="340" Height="28" Transparent="yes" Text="Select the folder where [ProductName] will be installed." />

        <Control Id="FolderLabel" Type="Text" X="15" Y="115" Width="340" Height="12" Transparent="yes" Text="Install folder:" />
        <Control Id="InstallFolder" Type="PathEdit" X="15" Y="130" Width="340" Height="18" Property="WIXUI_INSTALLDIR" Indirect="yes" />

        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="Back">
          <Publish Event="NewDialog" Value="MbmLicenseDlg" Condition="1" />
        </Control>
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="Install">
          <Publish Order="1" Event="Disable" Value="Next" Condition="1" />
          <Publish Order="2" Event="Disable" Value="Back" Condition="1" />
          <Publish Order="3" Event="Disable" Value="Cancel" Condition="1" />
          <Publish Order="4" Event="SetTargetPath" Value="[WIXUI_INSTALLDIR]" Condition="1" />
          <Publish Order="5" Event="NewDialog" Value="MbmProgressDlg" Condition="1" />
          <Publish Order="6" Event="DoAction" Value="ExecuteAction" Condition="1" />
        </Control>
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="Cancel">
          <Publish Event="SpawnDialog" Value="MbmCancelDlg" Condition="1" />
        </Control>
      </Dialog>

      <!-- Progress -->
      <Dialog Id="MbmProgressDlg" Width="370" Height="270" Title="[ProductName]" NoMinimize="yes" Modeless="yes">
        <Control Id="Banner" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="yes" Text="CustomUI_BannerBmp" />
        <Control Id="Line" Type="Line" X="0" Y="44" Width="370" Height="0" />

        <Control Id="Title" Type="Text" X="15" Y="58" Width="340" Height="18" Transparent="yes" NoPrefix="yes" Text="Installing" />
        <Control Id="ActionText" Type="Text" X="15" Y="82" Width="340" Height="30" Transparent="yes" Text="[ActionText]" />

        <Control Id="ProgressBar" Type="ProgressBar" X="15" Y="124" Width="340" Height="12" ProgressBlocks="yes" Text="Progress" />

        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="Cancel">
          <Publish Event="SpawnDialog" Value="MbmCancelDlg" Condition="1" />
        </Control>

      </Dialog>

      <!-- Exit -->
      <Dialog Id="MbmExitDlg" Width="370" Height="270" Title="[ProductName]" NoMinimize="yes">
        <Control Id="Banner" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="yes" Text="CustomUI_BannerBmp" />
        <Control Id="Line" Type="Line" X="0" Y="44" Width="370" Height="0" />

        <Control Id="Title" Type="Text" X="15" Y="58" Width="340" Height="18" Transparent="yes" NoPrefix="yes" Text="Setup Complete" />
        <Control Id="Description" Type="Text" X="15" Y="82" Width="340" Height="26" Transparent="yes" Text="[ProductName] has been installed on your computer." />

        <Control Id="Launch" Type="CheckBox" X="15" Y="122" Width="340" Height="16" Property="LAUNCHAPP" CheckBoxValue="1" Text="Launch [ProductName]" />

        <Control Id="Finish" Type="PushButton" X="304" Y="243" Width="56" Height="17" Default="yes" Text="Finish">
          <Publish Order="1" Event="DoAction" Value="LaunchApplication" Condition="LAUNCHAPP = 1 AND NOT Installed" />
          <Publish Order="2" Event="EndDialog" Value="Return" Condition="1" />
        </Control>
      </Dialog>

      <!-- Cancel confirmation -->
      <Dialog Id="MbmCancelDlg" Width="260" Height="85" Title="[ProductName]" NoMinimize="yes">
        <Control Id="Text" Type="Text" X="15" Y="15" Width="230" Height="25" Text="Are you sure you want to cancel setup?" />
        <Control Id="Yes" Type="PushButton" X="132" Y="57" Width="56" Height="17" Default="yes" Text="Yes">
          <Publish Event="EndDialog" Value="Exit" Condition="1" />
        </Control>
        <Control Id="No" Type="PushButton" X="194" Y="57" Width="56" Height="17" Cancel="yes" Text="No">
          <Publish Event="EndDialog" Value="Return" Condition="1" />
        </Control>
      </Dialog>

      <!-- Minimal standard dialogs required by ICE20 -->

      <Dialog Id="ErrorDlg" Width="260" Height="85" Title="Error" NoMinimize="yes">
        <Control Id="Text" Type="Text" X="15" Y="15" Width="230" Height="25" Text="An error occurred while installing [ProductName]." />
        <Control Id="Ok" Type="PushButton" X="194" Y="57" Width="56" Height="17" Default="yes" Cancel="yes" Text="OK">
          <Publish Event="EndDialog" Value="Return" Condition="1" />
        </Control>
      </Dialog>

      <Dialog Id="FatalError" Width="260" Height="85" Title="Setup Failed" NoMinimize="yes">
        <Control Id="Text" Type="Text" X="15" Y="15" Width="230" Height="25" Text="A fatal error occurred during installation." />
        <Control Id="Ok" Type="PushButton" X="194" Y="57" Width="56" Height="17" Default="yes" Cancel="yes" Text="OK">
          <Publish Event="EndDialog" Value="Exit" Condition="1" />
        </Control>
      </Dialog>

      <Dialog Id="UserExit" Width="260" Height="85" Title="Setup Canceled" NoMinimize="yes">
        <Control Id="Text" Type="Text" X="15" Y="15" Width="230" Height="25" Text="Setup was canceled." />
        <Control Id="Ok" Type="PushButton" X="194" Y="57" Width="56" Height="17" Default="yes" Cancel="yes" Text="OK">
          <Publish Event="EndDialog" Value="Exit" Condition="1" />
        </Control>
      </Dialog>

      <Dialog Id="Exit" Width="260" Height="85" Title="Setup Complete" NoMinimize="yes">
        <Control Id="Text" Type="Text" X="15" Y="15" Width="230" Height="25" Text="Setup has completed." />
        <Control Id="Ok" Type="PushButton" X="194" Y="57" Width="56" Height="17" Default="yes" Cancel="yes" Text="OK">
          <Publish Event="EndDialog" Value="Exit" Condition="1" />
        </Control>
      </Dialog>

      <Dialog Id="FilesInUse" Width="260" Height="85" Title="Files In Use" NoMinimize="yes">
        <Control Id="Text" Type="Text" X="15" Y="15" Width="230" Height="25" Text="Some files are in use. Close applications and retry." />
        <Control Id="Ok" Type="PushButton" X="194" Y="57" Width="56" Height="17" Default="yes" Cancel="yes" Text="OK">
          <Publish Event="EndDialog" Value="Return" Condition="1" />
        </Control>
      </Dialog>

    </UI>
  </Fragment>
</Wix>
